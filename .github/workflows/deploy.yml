name: WebGL을 itch.io에 배포하기

# 'main' 브랜치에 코드가 푸시될 때 이 워크플로우가 실행됩니다.
on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 단계 1: GitHub 저장소에서 코드를 가져옵니다.
      - name: 코드 체크아웃
        uses: actions/checkout@v3
        with:
          lfs: true 

      # 단계 2: Unity 프로젝트를 WebGL로 빌드합니다.
      - name: WebGL 빌드
        uses: game-ci/unity-builder@v4
        with:
          unityVersion: 2022.3.6f1 
          targetPlatform: WebGL
          projectPath: .
          buildsPath: 'Build/WebGL'

      # 단계 3: 빌드된 게임을 itch.io에 배포합니다.
      # 외부 액션 대신 Butler 툴을 직접 실행합니다.
      - name: itch.io에 배포
        run: |
          echo "Butler 툴 다운로드 중..."
          curl -L -o butler.zip https://broth.itch.ovh/butler/linux-amd64/LATEST/archive/default
          unzip butler.zip
          
          echo "게임 배포 시작..."
          ./butler push "Last-Breath-of-Terra/Last Breath of Terra/Build/WebGL" "PotatoTeam/attis:WebGL" --api-key="${{ secrets.ITCHIO_API_KEY }}"
          echo "게임 배포 완료!"