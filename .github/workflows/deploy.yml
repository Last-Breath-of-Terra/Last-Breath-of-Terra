name: WebGL을 itch.io에 배포하기

# 'main' 브랜치에 코드가 푸시될 때마다 이 워크플로우가 실행됩니다.
on:
  push:
    branches:
      - main 

jobs:
  deploy:
    # Unity 빌드에 필요한 환경을 설정해 줍니다.
    runs-on: ubuntu-latest
    steps:
      # 단계 1: GitHub 저장소에서 코드를 가져옵니다.
      - name: 코드 체크아웃
        uses: actions/checkout@v3
        with:
          lfs: true # LFS(Large File Storage) 파일을 가져오기 위해 필요합니다.

      # 단계 2: Unity 프로젝트를 WebGL로 빌드합니다.
      # 'game-ci/unity-builder' 액션을 사용하면 Unity 설치와 빌드가 자동으로 진행됩니다.
      - name: WebGL 빌드
        uses: game-ci/unity-builder@v4
        with:
          # 당신의 프로젝트가 사용하는 Unity 버전입니다.
          unityVersion: 2022.3.6f1 
          # 빌드할 플랫폼입니다.
          targetPlatform: WebGL
          # 저장소 루트를 기준으로 한 프로젝트 폴더 경로입니다.
          projectPath: Last-Breath-of-Terra/Last Breath of Terra
          # 빌드 결과물이 저장될 폴더 경로입니다.
          buildsPath: 'Build/WebGL'

      # 단계 3: 빌드된 게임을 itch.io에 배포합니다.
      # Butler 툴을 이용해 파일을 업로드합니다.
      - name: Deploy to itch.io
        uses: manley/butler-itchio-action@v1
        with:
          # GitHub Secrets에 저장한 itch.io API 키를 사용합니다.
          butler_api_key: ${{ secrets.ITCHIO_API_KEY }} 
          # 당신의 itch.io 사용자 이름입니다.
          itchio_user: 'PotatoTeam'
          # itch.io에 만든 게임 프로젝트의 이름입니다.
          itchio_game: 'attis'
          # 빌드된 파일이 있는 폴더 경로입니다.
          butler_path: 'Last-Breath-of-Terra/Last Breath of Terra/Build/WebGL'